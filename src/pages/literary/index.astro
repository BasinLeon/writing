---
import Layout from '../../layouts/Layout.astro';
import { getCollection } from 'astro:content';

const entries = (await getCollection('literary', ({ data }) => !data.isDraft))
  .sort((a, b) => b.data.publishDate.valueOf() - a.data.publishDate.valueOf());

const base = import.meta.env.BASE_URL;
const estimateReadMinutes = (text: string) => {
  const words = text.trim().split(/\s+/).filter(Boolean).length;
  return Math.max(1, Math.round(words / 220));
};
---

<Layout title="Literary Lane | Leon Basin Literary" description="Chronological archive of essays, fragments, and memory work.">
  <section class="latest">
    <p class="kicker">Chronological Archive</p>
    <h1>Literary Lane</h1>
    <p class="editorial-links"><a href={`${base}series/`}>Browse by series</a> <a href={`${base}tags/`}>Browse by tag</a></p>
    <ol class="writing-list">
      {entries.map((entry) => (
        <li>
          <a href={`${base}literary/${entry.slug}/`} class="writing-title">{entry.data.title}</a>
          <p class="writing-meta">
            {entry.data.publishDate.toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' })}
            {' • '}
            {entry.data.type}
            {' • '}
            {estimateReadMinutes(entry.body)} min read
          </p>
          <p class="lede">{entry.data.description}</p>
        </li>
      ))}
    </ol>
  </section>
</Layout>
